#!/usr/bin/python3

import os
import mimetypes
import random
import signal
import subprocess
import time

listdir = os.listdir()


def filterVid(file):
    fullPath = os.path.join(os.getcwd(), file)
    guessType = mimetypes.guess_type(fullPath)

    isFile = os.path.isfile(fullPath)
    isNotNoneType = guessType[0] is not None
    isVideo = isNotNoneType and (
        'video' in guessType[0] or file.endswith('.ts'))  # *.ts files are wrongly(?) identified by mimetypes as 'text'.

    if isFile and isVideo:
        return True
    else:
        return False


playlist = list(filter(filterVid, listdir))
random.shuffle(playlist)
playlist.insert(0, 'mpv')


print(len(playlist) - 1, 'videos found in cwd')

subprocess.Popen(playlist, start_new_session=True,
                 stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)
os.kill(os.getppid(), signal.SIGKILL)
